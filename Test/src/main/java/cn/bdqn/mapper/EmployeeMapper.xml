<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.bdqn.mapper.EmployeeMapper">
	<select id="queryEmployeeByName" parameterType="java.util.Map" resultType="Employee">
		select e.*,d.dName as dName,j.jName as jName from employee e LEFT JOIN
		department d ON e.departmentId=d.departmentId LEFT JOIN job j ON e.jobId=j.jobId
		<trim prefix="where" prefixOverrides="and | or">
			<if test="eName!=null and eName!=''">
				and  e.eName like CONCAT('%',#{eName},'%') 
			</if>
			<if test="begintime!=null and begintime!='' and (endtime==null or endtime=='')">
				and e.entryDate >= #{begintime} 
			</if>
			<if test="begintime!=null and begintime!='' and endtime!=null and endtime!=''">
				and e.entryDate BETWEEN #{begintime} and #{endtime} 
			</if>
			<if test="endtime!=null and endtime!='' and (begintime==null or begintime=='')">
				and e.entryDate <![CDATA[ <= ]]> #{endtime} 
			</if>
		</trim>
		limit #{start},#{end}
	</select>
	<select id="queryCount" parameterType="java.util.Map" resultType="int">
		select count(e.employeeId) from employee e LEFT JOIN
		department d ON e.departmentId=d.departmentId LEFT JOIN job j ON e.jobId=j.jobId
		<trim prefix="where" prefixOverrides="and | or">
			<if test="eName!=null and eName!=''">
				and  e.eName like CONCAT('%',#{eName},'%')
			</if>
			<if test="begintime!=null and begintime!='' and endtime==null">
				and e.entryDate >= #{begintime}
			</if>
			<if test="begintime!=null and begintime!='' and endtime!=null">
				and e.entryDate BETWEEN #{begintime} and #{endtime}
			</if>
			<if test="endtime!=null and endtime!='' and begintime==null">
				and e.entryDate <![CDATA[ <= ]]> #{endtime} 
			</if>
		</trim>
	</select>
	<select id="queryById" resultType="Employee" parameterType="String">
		select e.*,d.dName as dName,j.jName as jName from employee e LEFT JOIN
		department d ON e.departmentId=d.departmentId LEFT JOIN job j ON e.jobId=j.jobId
		where e.employeeId=#{employeeId}
	</select>
	<update id="updateEmployeeById">
		update 	employee set eName=#{eName},eSex=#{eSex},birthDate=#{birthDate},entryDate=#{entryDate},ePhone=#{ePhone},eAddress=#{eAddress},departmentId=#{departmentId},jobId=#{jobId},comments=#{comments}
		where employeeId=#{employeeId}
	</update>
</mapper>